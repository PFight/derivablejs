{"version":3,"file":"derivable.js","sources":["../src/util.js","../src/epoch.js","../src/transactions.js","../src/parents.js","../src/types.js","../src/atom.js","../src/reactors.js","../src/derivable.js","../src/derivation.js","../src/mutable.js","../src/lens.js","../src/module.js"],"sourcesContent":["export var keys = Object.keys;\n\nexport function assignPolyfill (obj) {\n  for (var i = 1; i < arguments.length; i++) {\n    var other = arguments[i];\n    var ks = keys(other || {});\n    for (var j = ks.length; j--;) {\n      var prop = ks[j];\n      obj[prop] = other[prop];\n    }\n  }\n  return obj;\n}\n\nexport var assign = Object.assign;\n\nif (!assign) {\n  assign = assignPolyfill;\n}\n\nfunction _is(a, b) {\n  // SameValue algorithm\n  if (a === b) { // Steps 1-5, 7-10\n    // Steps 6.b-6.e: +0 != -0\n    return a !== 0 || 1 / a === 1 / b;\n  } else {\n    // Step 6.a: NaN == NaN\n    return a !== a && b !== b;\n  }\n}\n\nexport function equals (a, b) {\n  return _is(a, b) || (a && typeof a.equals === 'function' && a.equals(b));\n};\n\nexport function addToArray (a, b) {\n  var i = a.indexOf(b);\n  if (i < 0) {\n    a.push(b);\n  }\n};\n\nexport function removeFromArray (a, b) {\n  var i = a.indexOf(b);\n  if (i >= 0) {\n    a.splice(i, 1);\n  }\n};\n\nvar _nextId = 0;\nexport function nextId () {\n  return _nextId++;\n};\n\nexport function slice (a, i) {\n  return Array.prototype.slice.call(a, i);\n};\n\nexport var unique = Object.freeze({equals: function () { return false; }});\n\nexport function some (x) {\n  return (x !== null) && (x !== void 0);\n};\n\nexport var DEBUG_MODE = false;\nexport function setDebugMode (val) {\n  DEBUG_MODE = !!val;\n};\n\nexport function setEquals (derivable, equals) {\n  derivable._equals = equals;\n  return derivable;\n};\n","export default {globalEpoch: 0};\n","import epoch from './epoch';\nimport * as util from './util';\n\nvar TransactionAbortion = {};\n\nfunction initiateAbortion() {\n  throw TransactionAbortion;\n}\n\nfunction TransactionContext(parent) {\n  this.parent = parent;\n  this.id2txnAtom = {};\n  this.globalEpoch = epoch.globalEpoch;\n  this.modifiedAtoms = [];\n}\n\nexport var currentCtx = null;\n\nexport function inTransaction () {\n  return currentCtx !== null;\n};\n\nexport function transact (f) {\n  beginTransaction();\n  try {\n    f.call(null, initiateAbortion);\n  }\n  catch (e) {\n    abortTransaction();\n    if (e !== TransactionAbortion) {\n      throw e;\n    }\n    return;\n  }\n  commitTransaction();\n};\n\nexport function transaction (f) {\n  return function () {\n    var args = util.slice(arguments, 0);\n    var that = this;\n    var result;\n    transact(function () {\n      result = f.apply(that, args);\n    });\n    return result;\n  };\n};\n\nfunction beginTransaction() {\n  currentCtx = new TransactionContext(currentCtx);\n}\n\nfunction commitTransaction() {\n  var ctx = currentCtx;\n  currentCtx = ctx.parent;\n  var reactorss = [];\n  ctx.modifiedAtoms.forEach(function (a) {\n    if (currentCtx !== null) {\n      a.set(ctx.id2txnAtom[a._id]._value);\n    }\n    else {\n      a._set(ctx.id2txnAtom[a._id]._value);\n      reactorss.push(a._reactors);\n    }\n  });\n  if (currentCtx === null) {\n    epoch.globalEpoch = ctx.globalEpoch;\n  } else {\n    currentCtx.globalEpoch = ctx.globalEpoch;\n  }\n  reactorss.forEach(processReactors);\n}\n\nfunction abortTransaction() {\n  var ctx = currentCtx;\n  currentCtx = ctx.parent;\n  if (currentCtx === null) {\n    epoch.globalEpoch = ctx.globalEpoch + 1;\n  }\n  else {\n    currentCtx.globalEpoch = ctx.globalEpoch + 1;\n  }\n}\n\nvar _tickerRefCount = 0;\n\nexport function ticker () {\n  if (_tickerRefCount === 0) {\n    beginTransaction();\n  }\n  _tickerRefCount++;\n  var done = false;\n  return {\n    tick: function () {\n      if (done) throw new Error('trying to use ticker after release');\n      commitTransaction();\n      beginTransaction();\n    },\n    reset: function () {\n      if (done) throw new Error('trying to use ticker after release');\n      abortTransaction();\n      beginTransaction();\n    },\n    release: function () {\n      if (done) throw new Error('ticker already released');\n      _tickerRefCount--;\n      done = true;\n      if (_tickerRefCount === 0) {\n        commitTransaction();\n      }\n    },\n  };\n};\n\nexport function processReactors(reactors, throwing) {\n  for (var i = 0; i < reactors.length;) {\n    var r = reactors[i];\n    if (r._reacting && throwing === true) {\n      throw new Error('cyclical update detected!');\n    } else {\n      r._maybeReact();\n    }\n    // maybe this reactor or another one to the left was sliced away\n    if (r === reactors[i]) {\n      i++;\n    }\n  }\n}\n","var parentsStack = [];\n\nexport function capturingParentsEpochs (f) {\n  var i = parentsStack.length;\n  parentsStack.push([]);\n  try {\n    f();\n    return parentsStack[i];\n  } finally {\n    parentsStack.pop();\n  }\n};\n\nexport function captureParent (p) {\n  if (parentsStack.length > 0) {\n    var top = parentsStack[parentsStack.length - 1];\n    top.push(p, 0);\n    return top.length-1;\n  } else {\n    return -1;\n  }\n};\n\nexport function captureEpoch (idx, epoch) {\n  if (parentsStack.length > 0) {\n    parentsStack[parentsStack.length - 1][idx] = epoch;\n  }\n};\n","export var ATOM = \"ATOM\";\nexport var DERIVATION = \"DERIVATION\";\nexport var LENS = \"LENS\";\nexport var REACTION = \"REACTION\";\n","import * as util from './util';\nimport * as transactions from './transactions';\nimport epoch from './epoch';\nimport * as parents from './parents';\nimport * as types from './types';\n\nexport function createPrototype (D, opts) {\n  return {\n    _clone: function () {\n      return util.setEquals(D.atom(this._value), this._equals);\n    },\n\n    set: function (value) {\n      if (transactions.currentCtx !== null) {\n        // we are in a transaction!\n        var inTxnThis = transactions.currentCtx.id2txnAtom[this._id];\n        if (inTxnThis != null) {\n          // we already have an in-txn verison of this atom, so update that\n          if (!this.__equals(value, inTxnThis._value)) {\n            inTxnThis._epoch++;\n            transactions.currentCtx.globalEpoch++;\n          }\n          inTxnThis._value = value;\n        } else {\n          // look for other versions of this atom in higher txn layers\n          var txnCtx = transactions.currentCtx.parent;\n          while (txnCtx !== null) {\n            inTxnThis = txnCtx.id2txnAtom[this._id];\n            if (inTxnThis !== void 0) {\n              // create new in-txn atom for this layer if need be\n              if (!this.__equals(inTxnThis._value, value)) {\n                var newInTxnThis = inTxnThis._clone();\n                newInTxnThis._id = this._id;\n                newInTxnThis._value = value;\n                newInTxnThis._epoch = inTxnThis._epoch + 1;\n                transactions.currentCtx.globalEpoch++;\n                transactions.currentCtx.id2txnAtom[this._id] = newInTxnThis;\n                util.addToArray(transactions.currentCtx.modifiedAtoms, this);\n              }\n              return;\n            } else {\n              txnCtx = txnCtx.parent;\n            }\n          }\n          // no in-txn versions of this atom yet;\n          transactions.currentCtx.globalEpoch++;\n          inTxnThis = this._clone();\n          inTxnThis._value = value;\n          inTxnThis._id = this._id;\n          inTxnThis._epoch = this._epoch + 1;\n          transactions.currentCtx.id2txnAtom[this._id] = inTxnThis;\n          util.addToArray(transactions.currentCtx.modifiedAtoms, this);\n        }\n      } else {\n        // not in a transaction\n        if (!this.__equals(value, this._value)) {\n          this._set(value);\n          transactions.processReactors(this._reactors, true);\n        }\n      }\n    },\n\n    _set: function (value) {\n      epoch.globalEpoch++;\n      this._epoch++;\n      this._value = value;\n    },\n\n    get: function () {\n      var inTxnThis;\n      var txnCtx = transactions.currentCtx;\n      while (txnCtx !== null) {\n        inTxnThis = txnCtx.id2txnAtom[this._id];\n        if (inTxnThis !== void 0) {\n          parents.captureEpoch(parents.captureParent(this), inTxnThis._epoch);\n          return inTxnThis._value;\n        }\n        else {\n          txnCtx = txnCtx.parent;\n        }\n      }\n      parents.captureEpoch(parents.captureParent(this), this._epoch);\n      return this._value;\n    },\n\n    _getEpoch: function () {\n      var inTxnThis;\n      var txnCtx = transactions.currentCtx;\n      while (txnCtx !== null) {\n        inTxnThis = txnCtx.id2txnAtom[this._id];\n        if (inTxnThis !== void 0) {\n          return inTxnThis._epoch;\n        }\n        else {\n          txnCtx = txnCtx.parent;\n        }\n      }\n      return this._epoch;\n    },\n  };\n};\n\nexport function construct (atom, value) {\n  atom._id = util.nextId();\n  atom._reactors = [];\n  atom._epoch = 0;\n  atom._value = value;\n  atom._type = types.ATOM;\n  atom._equals = null;\n  return atom;\n};\n","import * as types from './types';\nimport * as util from './util';\n\nvar reactorParentStack = [];\n\nexport function Reactor(react, derivable) {\n  this._derivable = derivable;\n  if (react) {\n    this.react = react;\n  }\n  this._atoms = [];\n  this._parent = null;\n  this._active = false;\n  this._yielding = false;\n  this._reacting = false;\n  this._type = types.REACTION;\n  if (util.DEBUG_MODE) {\n    this.stack = Error().stack;\n  }\n}\n\nfunction captureAtoms(derivable, atoms) {\n  if (derivable._type === types.ATOM) {\n    util.addToArray(atoms, derivable);\n  }\n  else {\n    for (var i = 0, len = derivable._lastParentsEpochs.length; i < len; i += 2) {\n      captureAtoms(derivable._lastParentsEpochs[i], atoms);\n    }\n  }\n}\n\nutil.assign(Reactor.prototype, {\n  start: function () {\n    this._lastValue = this._derivable.get();\n    this._lastEpoch = this._derivable._epoch;\n    this._atoms = [];\n    captureAtoms(this._derivable, this._atoms);\n    var that = this;\n    this._atoms.forEach(function (atom) {\n      util.addToArray(atom._reactors, that);\n    });\n\n    var len = reactorParentStack.length;\n    if (len > 0) {\n      this._parent = reactorParentStack[len - 1];\n    }\n    this._active = true;\n    this.onStart && this.onStart();\n    return this;\n  },\n  _force: function (nextValue) {\n    try {\n      reactorParentStack.push(this);\n      this._reacting = true;\n      this.react(nextValue);\n\n    } catch (e) {\n      if (util.DEBUG_MODE) {\n        console.error(this.stack);\n      }\n      throw e;\n    } finally {\n      this._reacting = false;\n      reactorParentStack.pop();\n    }\n  },\n  force: function () {\n    this._force(this._derivable.get());\n\n    return this;\n  },\n  _maybeReact: function () {\n    if (!this._reacting && this._active) {\n      if (this._yielding) {\n        throw Error('reactor dependency cycle detected');\n      }\n      if (this._parent !== null) {\n        this._yielding = true;\n        try {\n          this._parent._maybeReact();\n        } finally {\n          this._yielding = false;\n        }\n      }\n      // maybe the reactor was stopped by the parent\n      if (this._active) {\n        var nextValue = this._derivable.get();\n        if (this._derivable._epoch !== this._lastEpoch &&\n            !this._derivable.__equals(nextValue, this._lastValue)) {\n          this._force(nextValue);\n        }\n\n        // need to check atoms regardless of whether reactions happens\n        // TODO: incorporate atom capturing into .get somehow\n        this._lastEpoch = this._derivable._epoch;\n        this._lastValue = nextValue;\n        var oldAtoms = this._atoms;\n        var newAtoms = [];\n        this._atoms = newAtoms;\n        captureAtoms(this._derivable, newAtoms);\n\n        var that = this;\n\n        newAtoms.forEach(function (atom) {\n          var idx = oldAtoms.indexOf(atom);\n          if (idx === -1) {\n            util.addToArray(atom._reactors, that);\n          } else {\n            oldAtoms[idx] = null;\n          }\n        });\n\n        oldAtoms.forEach(function (atom) {\n          if (atom !== null) {\n            util.removeFromArray(atom._reactors, that);\n          }\n        });\n      }\n    }\n  },\n  stop: function () {\n    var that = this;\n    this._atoms.forEach(function (atom) {\n      return util.removeFromArray(atom._reactors, that);\n    });\n    this._atoms = [];\n    this._parent = null;\n    this._active = false;\n    this.onStop && this.onStop();\n    return this;\n  },\n  orphan: function () {\n    this._parent = null;\n    return this;\n  },\n  adopt: function (child) {\n    child._parent = this;\n    return this;\n  },\n  isActive: function () {\n    return this._active;\n  },\n});\n","import * as util from './util';\nimport * as reactors from './reactors';\n\nexport function createPrototype (D, opts) {\n  var x = {\n    /**\n     * Creates a derived value whose state will always be f applied to this\n     * value\n     */\n    derive: function (f, a, b, c, d) {\n      var that = this;\n      switch (arguments.length) {\n      case 0:\n        throw new Error('.derive takes at least one argument');\n      case 1:\n        switch (typeof f) {\n          case 'function':\n            return D.derivation(function () {\n              return f(that.get());\n            });\n          case 'string':\n          case 'number':\n            return D.derivation(function () {\n              return that.get()[D.unpack(f)];\n            });\n          default:\n            if (f instanceof Array) {\n              return f.map(function (x) {\n                return that.derive(x);\n              });\n            } else if (f instanceof RegExp) {\n              return D.derivation(function () {\n                return that.get().match(f);\n              });\n            } else if (D.isDerivable(f)) {\n              return D.derivation(function () {\n                var deriver = f.get();\n                var thing = that.get();\n                switch (typeof deriver) {\n                  case 'function':\n                    return deriver(thing);\n                  case 'string':\n                  case 'number':\n                    return thing[deriver];\n                  default:\n                    if (deriver instanceof RegExp) {\n                      return thing.match(deriver);\n                    } else {\n                      throw Error('type error');\n                    }\n                }\n              });\n            } else {\n              throw Error('type error');\n            }\n        }\n      case 2:\n        return D.derivation(function () {\n          return f(that.get(), D.unpack(a));\n        });\n      case 3:\n        return D.derivation(function () {\n          return f(that.get(), D.unpack(a), D.unpack(b));\n        });\n      case 4:\n        return D.derivation(function () {\n          return f(that.get(),\n                   D.unpack(a),\n                   D.unpack(b),\n                   D.unpack(c));\n        });\n      case 5:\n        return D.derivation(function () {\n          return f(that.get(),\n                   D.unpack(a),\n                   D.unpack(b),\n                   D.unpack(c),\n                   D.unpack(d));\n        });\n      default:\n        var args = ([that]).concat(util.slice(arguments, 1));\n        return D.derivation(function () {\n          return f.apply(null, args.map(D.unpack));\n        });\n      }\n    },\n\n\n\n    reactor: function (f) {\n      if (typeof f === 'function') {\n        return new reactors.Reactor(f, this);\n      } else if (f instanceof reactors.Reactor) {\n        if (typeof f.react !== 'function') {\n          throw new Error('reactor missing .react method');\n        }\n        f._derivable = this;\n        return f;\n      } else if (f && f.react) {\n        return util.assign(new reactors.Reactor(null, this), f);\n      } else {\n        throw new Error(\"Unrecognized type for reactor \" + f);\n      }\n    },\n\n    react: function (f, opts) {\n      if (typeof f !== 'function') {\n        throw Error('the first argument to .react must be a function');\n      }\n\n      opts = util.assign({\n        once: false,\n        from: true,\n        until: false,\n        when: true,\n        skipFirst: false,\n      }, opts);\n\n      // coerce fn or bool to derivable<bool>\n      function condDerivable(fOrD, name) {\n        if (!D.isDerivable(fOrD)) {\n          if (typeof fOrD === 'function') {\n            fOrD = D.derivation(fOrD);\n          } else if (typeof fOrD === 'boolean') {\n            fOrD = D.atom(fOrD);\n          } else {\n            throw Error('react ' + name + ' condition must be derivable');\n          }\n        }\n        return fOrD;\n      }\n\n      // wrap reactor so f doesn't get a .this context, and to allow\n      // stopping after one reaction if desired.\n      var reactor = this.reactor({\n        react: function (val) {\n          if (opts.skipFirst) {\n            opts.skipFirst = false;\n          } else {\n            f(val);\n            if (opts.once) {\n              this.stop();\n              controller.stop();\n            }\n          }\n        },\n        onStart: opts.onStart,\n        onStop: opts.onStop\n      });\n\n      // listen to when and until conditions, starting and stopping the\n      // reactor as appropriate, and stopping this controller when until\n      // condition becomes true\n      var controller = D.struct({\n        until: condDerivable(opts.until, 'until'),\n        when: condDerivable(opts.when, 'when')\n      }).reactor(function (conds) {\n        if (conds.until) {\n          reactor.stop();\n          this.stop();\n        } else if (conds.when) {\n          if (!reactor.isActive()) {\n            reactor.start().force();\n          }\n        } else if (reactor.isActive()) {\n          reactor.stop();\n        }\n      });\n\n      // listen to from condition, starting the reactor controller\n      // when appropriate\n      condDerivable(opts.from, 'from').reactor(function (from) {\n        if (from) {\n          controller.start().force();\n          this.stop();\n        }\n      }).start().force();\n    },\n\n    is: function (other) {\n      return D.lift(this._equals || opts.equals)(this, other);\n    },\n\n    and: function (other) {\n      return this.derive(function (x) {return x && D.unpack(other);});\n    },\n\n    or: function (other) {\n      return this.derive(function (x) {return x || D.unpack(other);});\n    },\n\n    then: function (thenClause, elseClause) {\n      return this.derive(function (x) {\n        return D.unpack(x ? thenClause : elseClause);\n      });\n    },\n\n    mThen: function (thenClause, elseClause) {\n      return this.derive(function (x) {\n        return D.unpack(util.some(x) ? thenClause : elseClause);\n      });\n    },\n\n    mOr: function (other) {\n      return this.mThen(this, other);\n    },\n\n    mDerive: function (arg) {\n      if (arguments.length === 1 && arg instanceof Array) {\n        var that = this;\n        return arg.map(function (a) { return that.mDerive(a); });\n      } else {\n        return this.mThen(this.derive.apply(this, arguments));\n      }\n    },\n\n    mAnd: function (other) {\n      return this.mThen(other, this);\n    },\n\n    not: function () {\n      return this.derive(function (x) { return !x; });\n    },\n\n    withEquality: function (equals) {\n      if (equals) {\n        if (typeof equals !== 'function') {\n          throw new Error('equals must be function');\n        }\n      } else {\n        equals = null;\n      }\n\n      return util.setEquals(this._clone(), equals);\n    },\n\n    __equals: function (a, b) {\n      return (this._equals || opts.equals)(a, b);\n    },\n  };\n\n  x.switch = function () {\n    var args = arguments;\n    return this.derive(function (x) {\n      var i;\n      for (i = 0; i < args.length-1; i+=2) {\n        if (opts.equals(x, D.unpack(args[i]))) {\n          return D.unpack(args[i+1]);\n        }\n      }\n      if (i === args.length - 1) {\n        return D.unpack(args[i]);\n      }\n    });\n  };\n\n  return x;\n};\n","import * as util from './util';\nimport * as parents from './parents';\nimport * as transactions from './transactions';\nimport epoch from './epoch';\nimport * as types from './types';\n\nexport function createPrototype (D, opts) {\n  return {\n    _clone: function () {\n      return util.setEquals(D.derivation(this._deriver), this._equals);\n    },\n\n    _forceEval: function () {\n      var that = this;\n      var newVal = null;\n      var capturedParentsEpochs = parents.capturingParentsEpochs(function () {\n        if (!util.DEBUG_MODE) {\n          newVal = that._deriver();\n        } else {\n          try {\n            newVal = that._deriver();\n          } catch (e) {\n            console.error(that.stack);\n            throw e;\n          }\n        }\n      });\n\n      if (!this.__equals(newVal, this._value)) {\n        this._epoch++;\n      }\n\n\n      this._lastParentsEpochs = capturedParentsEpochs;\n      this._value = newVal;\n    },\n\n    _update: function () {\n      var globalEpoch = transactions.currentCtx === null ?\n                         epoch.globalEpoch :\n                         transactions.currentCtx.globalEpoch;\n      if (this._lastGlobalEpoch !== globalEpoch) {\n        if (this._value === util.unique) {\n          // brand spanking new, so force eval\n          this._forceEval();\n        } else {\n          for (var i = 0, len = this._lastParentsEpochs.length; i < len; i += 2) {\n            var parent_1 = this._lastParentsEpochs[i];\n            var lastParentEpoch = this._lastParentsEpochs[i + 1];\n            var currentParentEpoch;\n            if (parent_1._type === types.ATOM) {\n              currentParentEpoch = parent_1._getEpoch();\n            } else {\n              parent_1._update();\n              currentParentEpoch = parent_1._epoch;\n            }\n            if (currentParentEpoch !== lastParentEpoch) {\n              this._forceEval();\n              return;\n            }\n          }\n        }\n        this._lastGlobalEpoch = globalEpoch;\n      }\n    },\n\n    get: function () {\n      var idx = parents.captureParent(this);\n      this._update();\n      parents.captureEpoch(idx, this._epoch);\n      return this._value;\n    },\n  };\n};\n\nexport function construct (obj, deriver) {\n  obj._deriver = deriver;\n  obj._lastParentsEpochs = [];\n  obj._lastGlobalEpoch = epoch.globalEpoch - 1;\n  obj._epoch = 0;\n  obj._type = types.DERIVATION;\n  obj._value = util.unique;\n  obj._equals = null;\n\n  if (util.DEBUG_MODE) {\n    obj.stack = Error().stack;\n  }\n\n  return obj;\n};\n","import * as util from './util';\n\nexport function createPrototype (D, _) {\n  return {\n    swap: function (f) {\n      var args = util.slice(arguments, 0);\n      args[0] = this.get();\n      return this.set(f.apply(null, args));\n    },\n    lens: function (monoLensDescriptor) {\n      var that = this;\n      return D.lens({\n        get: function () {\n          return monoLensDescriptor.get(that.get());\n        },\n        set: function (val) {\n          that.set(monoLensDescriptor.set(that.get(), val));\n        }\n      });\n    },\n  };\n};\n","import * as util from './util';\nimport * as types from './types';\n\n\nexport function createPrototype (D, _) {\n  return {\n    _clone: function () {\n      return util.setEquals(D.lens(this._lensDescriptor), this._equals);\n    },\n\n    set: function (value) {\n      var that = this;\n      D.atomically(function () {\n        that._lensDescriptor.set(value);\n      });\n      return this;\n    },\n  };\n};\n\nexport function construct (derivation, descriptor) {\n  derivation._lensDescriptor = descriptor;\n  derivation._type = types.LENS;\n\n  return derivation;\n};\n","import * as util from './util';\nimport * as transactions from './transactions';\nimport * as atom from './atom';\nimport * as reactors from './reactors';\nimport * as types from './types';\nimport * as derivable from './derivable';\nimport * as derivation from './derivation';\nimport * as mutable from './mutable';\nimport * as lens from './lens';\n\nvar defaultConfig = { equals: util.equals };\n\nfunction constructModule (config) {\n  config = util.assign({}, defaultConfig, config || {});\n\n  var D = {\n    transact: transactions.transact,\n    defaultEquals: util.equals,\n    setDebugMode: util.setDebugMode,\n    transaction: transactions.transaction,\n    ticker: transactions.ticker,\n    Reactor: reactors.Reactor,\n    isAtom: function (x) {\n      return x && (x._type === types.ATOM || x._type === types.LENS);\n    },\n    isDerivable: function (x) {\n      return x && (x._type === types.ATOM ||\n                   x._type === types.LENS ||\n                   x._type === types.DERIVATION);\n    },\n    isDerivation: function (x) {\n      return x && (x._type === types.DERIVATION || x._type === types.LENS);\n    },\n    isLensed: function (x) {\n      return x && x._type === types.LENS;\n    },\n    isReactor: function (x) {\n      return x && x._type === types.REACTION;\n    },\n  };\n\n  var Derivable  = derivable.createPrototype(D, config);\n  var Mutable    = mutable.createPrototype(D, config);\n\n  var Atom       = util.assign({}, Mutable, Derivable,\n                               atom.createPrototype(D, config));\n\n  var Derivation = util.assign({}, Derivable,\n                               derivation.createPrototype(D, config));\n\n  var Lens       = util.assign({}, Mutable, Derivation,\n                              lens.createPrototype(D, config));\n\n\n  /**\n   * Constructs a new atom whose state is the given value\n   */\n  D.atom = function (val) {\n    return atom.construct(Object.create(Atom), val);\n  };\n\n  /**\n   * Returns a copy of f which runs atomically\n   */\n  D.atomic = function (f) {\n    return function () {\n      var result;\n      var that = this;\n      var args = arguments;\n      D.atomically(function () {\n        result = f.apply(that, args);\n      });\n      return result;\n    };\n  };\n\n  D.atomically = function (f) {\n    if (transactions.inTransaction()) {\n      f();\n    } else {\n      D.transact(f);\n    }\n  };\n\n  D.derivation = function (f) {\n    return derivation.construct(Object.create(Derivation), f);\n  };\n\n  /**\n   * Template string tag for derivable strings\n   */\n  D.derive = function (parts) {\n    var args = util.slice(arguments, 1);\n    return D.derivation(function () {\n      var s = \"\";\n      for (var i=0; i < parts.length; i++) {\n        s += parts[i];\n        if (i < args.length) {\n          s += D.unpack(args[i]);\n        }\n      }\n      return s;\n    });\n  };\n\n  /**\n   * creates a new lens\n   */\n  D.lens = function (descriptor) {\n    return lens.construct(\n      derivation.construct(Object.create(Lens), descriptor.get),\n      descriptor\n    );\n  };\n\n  /**\n   * dereferences a thing if it is dereferencable, otherwise just returns it.\n   */\n  D.unpack = function (thing) {\n    if (D.isDerivable(thing)) {\n      return thing.get();\n    } else {\n      return thing;\n    }\n  };\n\n  /**\n   * lifts a non-monadic function to work on derivables\n   */\n  D.lift = function (f) {\n    return function () {\n      var args = arguments;\n      var that = this;\n      return D.derivation(function () {\n        return f.apply(that, Array.prototype.map.call(args, D.unpack));\n      });\n    };\n  };\n\n  function deepUnpack (thing) {\n    if (D.isDerivable(thing)) {\n      return thing.get();\n    } else if (thing instanceof Array) {\n      return thing.map(deepUnpack);\n    } else if (thing.constructor === Object) {\n      var result = {};\n      var keys = util.keys(thing);\n      for (var i = keys.length; i--;) {\n        var prop = keys[i];\n        result[prop] = deepUnpack(thing[prop]);\n      }\n      return result;\n    } else {\n      return thing;\n    }\n  }\n\n  D.struct = function (arg) {\n    if (arg.constructor === Object || arg instanceof Array) {\n      return D.derivation(function () {\n        return deepUnpack(arg);\n      });\n    } else {\n      throw new Error(\"`struct` expects plain Object or Array\");\n    }\n  };\n\n  function andOrFn (breakOn) {\n    return function () {\n      var args = arguments;\n      return D.derivation(function () {\n        var val;\n        for (var i = 0; i < args.length; i++) {\n          val = D.unpack(args[i]);\n          if (breakOn(val)) {\n            break;\n          }\n        }\n        return val;\n      });\n    };\n  }\n  function identity (x) { return x; }\n  function complement (f) { return function (x) { return !f(x); }; }\n  D.or = andOrFn(identity);\n  D.mOr = andOrFn(util.some);\n  D.and = andOrFn(complement(identity));\n  D.mAnd = andOrFn(complement(util.some));\n\n  return D;\n}\n\nutil.assign(exports, constructModule());\nexports.withEquality = function (equals) {\n  return constructModule({equals: equals});\n};\nexports['default'] = exports;\n"],"names":["util.slice","transactions.currentCtx","parents.captureParent","parents.captureEpoch","transactions.processReactors","util.addToArray","util.setEquals","types.ATOM","util.nextId","util.DEBUG_MODE","types.REACTION","util.removeFromArray","util.assign","util.some","reactors.Reactor","createPrototype","util.unique","parents.capturingParentsEpochs","types.DERIVATION","construct","types.LENS","util.equals","util.keys","derivation.construct","lens.construct","transactions.inTransaction","atom.construct","lens.createPrototype","derivation.createPrototype","atom.createPrototype","mutable.createPrototype","derivable.createPrototype","transactions.ticker","transactions.transaction","util.setDebugMode","transactions.transact","keys"],"mappings":"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"}